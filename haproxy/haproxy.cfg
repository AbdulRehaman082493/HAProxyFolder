#===========================================================
# HAProxy Base Configuration (Shared Across All Environments)
#===========================================================

#-----------------------------------------------------------
# Global settings
#-----------------------------------------------------------
global
    log /dev/log local0
    log /dev/log local1 notice
    user haproxy
    group haproxy
    daemon
    maxconn 4096

#-----------------------------------------------------------
# Default settings for all frontends/backends
#-----------------------------------------------------------
defaults
    log     global
    mode    tcp
    option  tcplog
    option  dontlognull
    timeout connect 5s
    timeout client  50s
    timeout server  50s
    retries 3

#-----------------------------------------------------------
# DNS Resolver Placeholder (overridden in each environment)
#-----------------------------------------------------------
resolvers dns_env
    # Real DNS values are in environment-specific files (dev/test/stage/prod)
    nameserver dns1 0.0.0.0:53
    resolve_retries 3
    timeout resolve 5s
    timeout retry   1s
    hold valid      10s

#-----------------------------------------------------------
# Frontend ports (same across all envs)
#-----------------------------------------------------------
frontend fe_sql_1445
    bind *:1445
    mode tcp
    default_backend be_sql_1445

frontend fe_sql_1446
    bind *:1446
    mode tcp
    default_backend be_sql_1446

frontend fe_sql_1447
    bind *:1447
    mode tcp
    default_backend be_sql_1447

#-----------------------------------------------------------
# Backends (environment-specific servers added in env file)
#-----------------------------------------------------------
backend be_sql_1445
    mode tcp
    balance roundrobin
    option tcp-check
    default-server inter 3s rise 1 fall 1 resolve-prefer ipv4

backend be_sql_1446
    mode tcp
    balance roundrobin
    option tcp-check
    default-server inter 3s rise 1 fall 1 resolve-prefer ipv4

backend be_sql_1447
    mode tcp
    balance roundrobin
    option tcp-check
    default-server inter 3s rise 1 fall 1 resolve-prefer ipv4
